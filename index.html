<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CFA Prep</title>
  <link id="google-fonts" rel="stylesheet" href="" />
  <style>
    body { margin: 0; display: flex; height: 100vh; font-family: Arial, sans-serif; color: #000; background-color: #fff; }
    #sidebar { width: 250px; background-color: #f0f0f0; padding: 20px; box-sizing: border-box; border-right: 1px solid #ccc; display: flex; flex-direction: column; gap: 20px; }
    #main { flex-grow: 1; padding: 20px; box-sizing: border-box; overflow-y: auto; }
    h2 { margin-top: 0; }
    #timer-display { font-size: 2em; text-align: center; margin-bottom: 10px; }
    .timer-controls button { margin: 5px 2px; padding: 5px 10px; font-size: 1em; }
    .timer-inputs label { display: block; margin-bottom: 5px; }
    .timer-inputs input { width: 100%; margin-bottom: 10px; box-sizing: border-box; padding: 5px; }
    #music-section input { width: 100%; box-sizing: border-box; padding: 5px; margin-bottom: 5px; }
    #music-section button { margin-bottom: 10px; padding: 5px; width: 100%; }
    #music-player { width: 100%; height: 0; transition: height 0.3s; overflow: hidden; }
    #music-player iframe { width: 100%; height: 200px; }
    #latex-form { display: flex; flex-direction: column; gap: 10px; }
    #latex-input { width: 100%; height: 200px; font-family: monospace; font-size: 1em; padding: 10px; box-sizing: border-box; }
    #options { display: flex; gap: 10px; align-items: center; }
    #options label { margin-right: 5px; }
    #options select, #options input { padding: 5px; font-size: 1em; }
    #generate-btn { padding: 10px 20px; font-size: 1em; align-self: flex-start; }
    #latex-preview { visibility: hidden; position: absolute; top: -9999px; left: -9999px; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
</head>
<body>
  <div id="sidebar"> ... Pomodoro and Music sections unchanged ... </div>
  <div id="main">
    <h2>LaTeX to PDF Cheatsheet</h2>
    <form id="latex-form" onsubmit="return false;">
      <textarea id="latex-input" placeholder="Enter LaTeX code here..."></textarea>
      <div id="options">
        <div><label for="font-family">Font Family:</label><select id="font-family"><option value="Roboto">Roboto</option><option value="Open+Sans">Open Sans</option><option value="Lato">Lato</option><option value="Montserrat">Montserrat</option><option value="Source+Sans+Pro">Source Sans Pro</option></select></div>
        <div><label for="font-size">Font Size (pt):</label><input type="number" id="font-size" value="12" min="6" max="36"/></div>
      </div>
      <button id="generate-btn">Generate PDF</button>
    </form>
    <div id="latex-preview"></div>
  </div>
  <script>
    // LaTeX to PDF Logic (simplified)
    const generateBtn = document.getElementById('generate-btn');
    const latexInput = document.getElementById('latex-input');
    const latexPreview = document.getElementById('latex-preview');
    const fontFamilySelect = document.getElementById('font-family');
    const fontSizeInput = document.getElementById('font-size');
    
    async function loadGoogleFont(font) {
      const link = document.getElementById('google-fonts');
      link.href = `https://fonts.googleapis.com/css2?family=${font}&display=swap`;
      document.body.style.fontFamily = `'${font.replace(/\+/g, ' ')}', sans-serif`;
      return new Promise((res) => { link.onload = res; });
    }
    
    async function generatePDF() {
      const code = latexInput.value.trim();
      if (!code) { alert('Please enter LaTeX code'); return; }
      const fontKey = fontFamilySelect.value;
      const size = parseInt(fontSizeInput.value);
      await loadGoogleFont(fontKey);
      latexPreview.innerHTML = `$$${code}$$`;
      await MathJax.typesetPromise([latexPreview]);
      latexPreview.style.fontSize = `${size}pt`;
      latexPreview.style.background = '#fff'; latexPreview.style.padding = '10px'; latexPreview.style.color = '#000';
      setTimeout(async () => {
        const canvas = await html2canvas(latexPreview, { backgroundColor: '#fff' });
        const imgData = canvas.toDataURL('image/png');
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({ unit: 'mm', format: [74, 105] });
        const props = pdf.getImageProperties(imgData);
        const pdfW = 74;
        const pdfH = (props.height * pdfW) / props.width;
        pdf.addImage(imgData, 'PNG', 0, 0, pdfW, pdfH);
        // trigger download via blob link
        const blob = pdf.output('blob');
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'cheatsheet.pdf';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }, 500);
    }
    
    generateBtn.addEventListener('click', generatePDF);
  </script>
</body>
</html>
